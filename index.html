<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®šãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }

        .card {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        }

        /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ã¤ã¾ã¿ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            /* ãƒ¢ãƒã‚¤ãƒ«ã§ã®ã‚¿ãƒƒãƒ—ã—ã‚„ã™ã•ã‚’è€ƒæ…®ã—ã¦å¤§ãã */
            height: 24px;
            /* ãƒ¢ãƒã‚¤ãƒ«ã§ã®ã‚¿ãƒƒãƒ—ã—ã‚„ã™ã•ã‚’è€ƒæ…®ã—ã¦å¤§ãã */
            background: #10b981;
            cursor: pointer;
            border-radius: 50%;
            border: 4px solid white;
            /* å¢ƒç•Œç·šã‚’å¤ªã */
            transition: background 0.3s, transform 0.1s;
        }

        .slider-thumb:hover {
            background: #059669;
        }

        input[type="range"]::-webkit-slider-thumb {
            @apply slider-thumb;
        }

        input[type="range"]::-moz-range-thumb {
            @apply slider-thumb;
        }

        /* æƒ…å ±ãƒœãƒƒã‚¯ã‚¹ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .info-box {
            background-color: #ecfdf5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        /* datetime-localã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ */
        input[type="datetime-local"] {
            box-sizing: border-box;
            /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒœãƒ¼ãƒ€ãƒ¼ã‚’å«ã‚ã¦å¹…ã‚’è¨ˆç®— */
            /* å¿…è¦ã§ã‚ã‚Œã°ã“ã“ã§ã•ã‚‰ã«ç‰¹å®šã®ãƒ–ãƒ©ã‚¦ã‚¶å‘ã‘ã®èª¿æ•´ */
            width: 76vw;
        }
    </style>
</head>

<body class="p-4 min-h-screen flex items-start justify-center">

    <!-- ã‚³ãƒ³ãƒ†ãƒŠã®æœ€å¤§å¹…ã‚’ max-w-sm ã«å¤‰æ›´ã—ã¦ãƒ¢ãƒã‚¤ãƒ«ã«æœ€é©åŒ– -->
    <div class="w-full max-w-sm bg-white p-6 rounded-xl card space-y-6">
        <!-- ä¿®æ­£ã•ã‚ŒãŸãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <h1 class="text-2xl font-bold text-gray-800 border-b pb-3 mb-4">
            <span class="text-3xl font-extrabold text-emerald-600">MamoRun</span><br>
            <span class="text-base font-semibold text-gray-500">é…åˆ»å¯¾ç­– ãƒªãƒã‚¤ãƒ³ãƒ‰</span>
        </h1>
        <p class="text-sm text-gray-500 mb-6">è¨­å®šã‚¹ãƒ†ãƒƒãƒ—ã‚’æœ€å°é™ã«æŠ‘ãˆã€æº–å‚™æ™‚é–“ã®ã¿ã‚’èª¿æ•´ã§ãã¾ã™ã€‚</p>

        <!-- è¨­å®šãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="space-y-5">

            <!-- å¾…ã¡åˆã‚ã›æ—¥æ™‚ -->
            <div>
                <label for="meetingTime" class="block text-sm font-medium text-gray-700">1. é›†åˆæ—¥æ™‚ï¼ˆå¿…é ˆï¼‰</label>
                <!-- px-4 py-3 border border-gray-300 rounded-lg text-lg focus:ring-emerald-500 focus:border-emerald-500 --><!-- Tailwindã®ã‚¯ãƒ©ã‚¹ã¯ãã®ã¾ã¾ã«ã€box-sizingã§è§£æ±ºã‚’è©¦ã¿ã¾ã™ --><input
                    type="datetime-local" id="meetingTime"
                    class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg text-lg focus:ring-emerald-500 focus:border-emerald-500"
                    required>
            </div>

            <!-- å¾…ã¡åˆã‚ã›å ´æ‰€ (å…¥åŠ›ç°¡ç•¥åŒ–ã®ãŸã‚ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›) -->
            <div>
                <label for="location" class="block text-sm font-medium text-gray-700">2. é›†åˆå ´æ‰€</label>
                <input type="text" id="location" value="æ¸‹è°·é§…"
                    class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 cursor-not-allowed text-lg"
                    disabled>
                <p class="text-xs text-gray-500 mt-1"></p>
            </div>

            <!-- æº–å‚™æ™‚é–“èª¿æ•´ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ -->
            <div class="pt-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">3. æº–å‚™æ™‚é–“èª¿æ•´</label>
                <input type="range" min="-1" max="1" value="0" id="prepAdjustment"
                    class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                    oninput="updateAdjustmentLabel()">

                <div class="flex justify-between text-xs mt-3 text-gray-600 font-semibold">
                    <span id="labelRush" class="text-center w-1/3">æ€¥ã<br>(-10åˆ†)</span>
                    <span id="labelNormal" class="text-center w-1/3">ã„ã¤ã‚‚é€šã‚Š<br>(0åˆ†)</span>
                    <span id="labelRelaxed" class="text-center w-1/3">ã‚†ã£ãŸã‚Š<br>(+15åˆ†)</span>
                </div>

                <p id="currentAdjustment" class="text-center mt-4 text-xl font-bold text-emerald-600">èª¿æ•´æ™‚é–“: 0åˆ†</p>
            </div>

            <!-- å¾…ã¡åˆã‚ã›è¨­å®šãƒœã‚¿ãƒ³ --><button onclick="setReminder()"
                class="w-full py-4 mt-8 bg-emerald-500 text-white font-bold text-lg rounded-lg hover:bg-emerald-600 transition duration-150 shadow-lg shadow-emerald-200">
                ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®šã‚’ç¢ºå®š
            </button>
        </div>

        <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="resultArea" class="mt-8 pt-5 border-t border-gray-100 hidden">
            <div class="info-box p-4 rounded-lg">
                <p class="font-semibold mb-1">âœ… è¨­å®šå®Œäº†: ã‚ãªãŸã®æœ€é©ãªå‡ºç™ºæ™‚é–“</p>
                <p id="departureTimeDisplay" class="text-2xl font-extrabold text-gray-800"></p>
                <p id="notesDisplay" class="text-sm mt-2"></p>
            </div>
            <p class="text-xs text-red-500 mt-3">â€»ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã‚‹ã¨ã‚¢ãƒ©ãƒ¼ãƒ ã¯è§£é™¤ã•ã‚Œã¾ã™ã€‚å‹•ä½œãƒ†ã‚¹ãƒˆã®ãŸã‚ã«ã€è¨­å®šæ™‚åˆ»ã®æ•°åˆ†å¾Œã®æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
        </div>

        <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ -->
        <div id="messageBox" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white p-8 rounded-xl shadow-2xl w-11/12 max-w-xs text-center space-y-4">
                <p class="text-2xl text-emerald-600 font-bold">ğŸ“¢ ãƒªãƒã‚¤ãƒ³ãƒ‰!</p>
                <p id="alertMessage" class="text-gray-700 text-lg"></p>
                <button onclick="closeMessageBox()"
                    class="w-full py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600">OK</button>
            </div>
        </div>
    </div>

    <script>
        // --- å®šæ•°ã¨ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ---
        const MOCK_TRAVEL_TIME_MIN = 45; // ä»®ã®ç§»å‹•æ™‚é–“ (åˆ†)
        const BASE_PREP_TIME_MIN = 30;   // åŸºç¤ã¨ãªã‚‹æº–å‚™æ™‚é–“ (åˆ†)

        // èª¿æ•´ãƒ¬ãƒ™ãƒ«ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å€¤:-1, 0, 1 ã«å¯¾å¿œï¼‰
        const ADJUSTMENT_MAP = {
            '-1': { label: 'æ€¥ã', minutes: -10 },
            '0': { label: 'ã„ã¤ã‚‚é€šã‚Š', minutes: 0 },
            '1': { label: 'ã‚†ã£ãŸã‚Š', minutes: 15 }
        };

        let reminderTimeoutId;

        // --- DOMè¦ç´ ã®åˆæœŸåŒ–ã¨ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š ---
        document.addEventListener('DOMContentLoaded', () => {
            // ç¾åœ¨ã®æ—¥æ™‚ã‚’è¨­å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®åˆæœŸå€¤ã«ã™ã‚‹ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
            const now = new Date();
            now.setMinutes(now.getMinutes() + 5); // 5åˆ†å¾Œã«è¨­å®š
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('meetingTime').value = `${year}-${month}-${day}T${hours}:${minutes}`;

            // Notification APIã®è¨±å¯ã‚’æ±‚ã‚ã‚‹ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥ç”¨ï¼‰
            if ('Notification' in window && Notification.permission !== 'granted') {
                Notification.requestPermission();
            }
            updateAdjustmentLabel();
        });

        /**
         * æº–å‚™æ™‚é–“èª¿æ•´ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ãƒ©ãƒ™ãƒ«ã¨å€¤ã‚’æ›´æ–°ã™ã‚‹
         */
        function updateAdjustmentLabel() {
            const sliderValue = document.getElementById('prepAdjustment').value;
            const adjustment = ADJUSTMENT_MAP[sliderValue];
            document.getElementById('currentAdjustment').textContent = `èª¿æ•´æ™‚é–“: ${adjustment.minutes}åˆ† (${adjustment.label})`;
        }

        /**
         * ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ï¼‰ã‚’è¡¨ç¤ºã™ã‚‹
         * @param {string} message - è¡¨ç¤ºã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
         */
        function showMessageBox(message) {
            document.getElementById('alertMessage').textContent = message;
            // fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50
            document.getElementById('messageBox').classList.remove('hidden');
            document.getElementById('messageBox').classList.add('flex');
        }

        /**
         * ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ï¼‰ã‚’é–‰ã˜ã‚‹
         */
        function closeMessageBox() {
            document.getElementById('messageBox').classList.remove('flex');
            document.getElementById('messageBox').classList.add('hidden');
        }

        /**
         * ãƒ–ãƒ©ã‚¦ã‚¶ã®é€šçŸ¥æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚’å‡ºã™
         * @param {string} title - é€šçŸ¥ã®ã‚¿ã‚¤ãƒˆãƒ«
         * @param {string} body - é€šçŸ¥ã®æœ¬æ–‡
         */
        function showBrowserNotification(title, body) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, { body: body, icon: 'https://placehold.co/64x64/10b981/ffffff?text=Go' });
            } else {
                // NotificationãŒè¨±å¯ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆã§ä»£æ›¿
                showMessageBox(body);
            }
        }

        /**
         * ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®šã‚’ç¢ºå®šã—ã€ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚»ãƒƒãƒˆã™ã‚‹
         */
        function setReminder() {
            const meetingTimeInput = document.getElementById('meetingTime');
            const sliderValue = document.getElementById('prepAdjustment').value;

            if (!meetingTimeInput.value) {
                showMessageBox('é›†åˆæ—¥æ™‚ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            // æ—¢å­˜ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
            if (reminderTimeoutId) {
                clearTimeout(reminderTimeoutId);
            }

            const meetingTime = new Date(meetingTimeInput.value);
            const now = new Date();

            // 1. èª¿æ•´æ™‚é–“ï¼ˆåˆ†ï¼‰ã®è¨ˆç®—
            const adjustmentMin = ADJUSTMENT_MAP[sliderValue].minutes;

            // 2. ç·å¿…è¦æ™‚é–“ï¼ˆåˆ†ï¼‰ã®è¨ˆç®—
            const totalBufferMin = MOCK_TRAVEL_TIME_MIN + BASE_PREP_TIME_MIN + adjustmentMin;

            // 3. å‡ºç™ºæ¨å¥¨æ™‚åˆ»ã®è¨ˆç®— (ãƒŸãƒªç§’)
            // é›†åˆæ™‚åˆ»(ms) - (ç·å¿…è¦æ™‚é–“ * 60 * 1000)
            const departureTimeMs = meetingTime.getTime() - (totalBufferMin * 60 * 1000);
            const departureTime = new Date(departureTimeMs);

            // 4. ã‚¢ãƒ©ãƒ¼ãƒ ã¾ã§ã®æ™‚é–“å·® (ãƒŸãƒªç§’)
            const timeUntilAlarmMs = departureTimeMs - now.getTime();

            if (timeUntilAlarmMs <= 0) {
                showMessageBox('è¨­å®šã•ã‚ŒãŸå‡ºç™ºæ¨å¥¨æ™‚åˆ»ã¯éå»ã§ã™ã€‚æœªæ¥ã®æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                document.getElementById('resultArea').classList.add('hidden');
                return;
            }

            // 5. ã‚¿ã‚¤ãƒãƒ¼ã®ã‚»ãƒƒãƒˆ
            reminderTimeoutId = setTimeout(() => {
                const message = `é›†åˆå ´æ‰€ï¼ˆæ¸‹è°·é§…ï¼‰ã¸å‘ã‹ã†ãŸã‚ã®æœ€é©ãªå‡ºç™ºæ™‚åˆ»ã§ã™ã€‚\nç·ç§»å‹•æ™‚é–“ ${MOCK_TRAVEL_TIME_MIN}åˆ† + æº–å‚™æ™‚é–“ ${BASE_PREP_TIME_MIN}åˆ† + èª¿æ•´ ${adjustmentMin}åˆ† = è¨ˆ ${totalBufferMin}åˆ†`;
                showBrowserNotification('å‡ºç™ºãƒªãƒã‚¤ãƒ³ãƒ‰ğŸš¨', message);
                document.getElementById('resultArea').classList.add('hidden');
            }, timeUntilAlarmMs);

            // çµæœè¡¨ç¤ºã‚’æ›´æ–°
            const timeFormat = { hour: '2-digit', minute: '2-digit', hour12: false };
            const dateFormat = { month: 'numeric', day: 'numeric' };

            document.getElementById('departureTimeDisplay').textContent =
                departureTime.toLocaleDateString('ja-JP', dateFormat) +
                ' ' +
                departureTime.toLocaleTimeString('ja-JP', timeFormat);

            document.getElementById('notesDisplay').innerHTML = `
            ï¼ˆé›†åˆ: ${meetingTime.toLocaleTimeString('ja-JP', timeFormat)}ï¼‰<br>
            ç§»å‹•æ™‚é–“ (ä»®): ${MOCK_TRAVEL_TIME_MIN}åˆ† + æº–å‚™æ™‚é–“ (åŸºæœ¬): ${BASE_PREP_TIME_MIN}åˆ† 
            ${adjustmentMin >= 0 ? '+' : ''}${adjustmentMin}åˆ† = ç·ãƒãƒƒãƒ•ã‚¡: ${totalBufferMin}åˆ†
        `;
            document.getElementById('resultArea').classList.remove('hidden');

            console.log(`ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚»ãƒƒãƒˆå®Œäº†ã€‚ã‚¢ãƒ©ãƒ¼ãƒ ã¾ã§ ${Math.ceil(timeUntilAlarmMs / 1000)}ç§’ã€‚`);
        }
    </script>


    <script>
        (function (d) {
            var config = {
                kitId: 'ohm1sor',
                scriptTimeout: 3000,
                async: true
            },
                h = d.documentElement, t = setTimeout(function () { h.className = h.className.replace(/\bwf-loading\b/g, "") + " wf-inactive"; }, config.scriptTimeout), tk = d.createElement("script"), f = false, s = d.getElementsByTagName("script")[0], a; h.className += " wf-loading"; tk.src = 'https://use.typekit.net/' + config.kitId + '.js'; tk.async = true; tk.onload = tk.onreadystatechange = function () { a = this.readyState; if (f || a && a != "complete" && a != "loaded") return; f = true; clearTimeout(t); try { Typekit.load(config) } catch (e) { } }; s.parentNode.insertBefore(tk, s)
        })(document);
    </script>

</body>

</html>
