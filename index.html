<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MamoRun</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿: 
           Inter(æœ¬æ–‡ç”¨), 
           Barlow Semi Condensed(æ•°å­—ç”¨),
           Varela Round(ã‚¿ã‚¤ãƒˆãƒ«ç”¨ - ä¸¸ã„ãƒ•ã‚©ãƒ³ãƒˆ)
        */
        @import url('https://fonts.googleapis.com/css2?family=Barlow+Semi+Condensed:wght@600;700&family=Inter:wght@500;700&family=Varela+Round&display=swap');

        /* ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            /* æ—¥æœ¬èªã¯æ¸¸ã‚´ã‚·ãƒƒã‚¯ã€è‹±æ•°å­—ã¯Inter */
            font-family: "Inter", "Yu Gothic Medium", "Yu Gothic", YuGothic, "Hiragino Kaku Gothic ProN", "Hiragino Kaku Gothic Pro", "Meiryo", sans-serif;
            background: #f0f4f8;
            color: #475569;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
            min-height: 100dvh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        @media (min-width: 450px) {
            body {
                align-items: center;
                padding: 20px;
            }
        }

        /* --- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¹ã‚¿ã‚¤ãƒ« --- */

        .app-container {
            width: 100%;
            max-width: 420px;
            background: white;
            box-shadow: 0 0 50px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ */
        @media (max-width: 449px) {
            .app-container {
                height: 100dvh;
            }
        }

        /* PC/ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç”¨ãƒ•ãƒ¬ãƒ¼ãƒ  */
        @media (min-width: 450px) {
            .app-container {
                height: 90vh;
                max-height: 850px;
                border-radius: 40px;
                border: 8px solid #fff;
                box-shadow: 0 20px 60px -10px rgba(0, 0, 0, 0.15);
            }
        }

        /* --- ã‚¨ãƒªã‚¢åˆ†å‰² --- */

        .scroll-view {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            width: 100%;
            position: relative;
            scrollbar-width: none;
        }
        .scroll-view::-webkit-scrollbar { display: none; }

        .footer-area {
            flex-shrink: 0;
            background: white;
            padding: 1rem 1.5rem 1.5rem;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.03);
            z-index: 50;
            width: 100%;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header-bg {
            background-color: #10b981;
            padding: 3rem 1.5rem 4rem;
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            color: white;
            text-align: center;
            box-shadow: 0 10px 30px -10px rgba(16, 185, 129, 0.5);
            position: relative;
            z-index: 10;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes popJump {
            0%, 90%, 100% {
                transform: translateY(0) scale(1);
            }
            92% {
                transform: translateY(2px) scale(0.98, 1.02); /* è¸ã¿è¾¼ã¿ */
            }
            95% {
                transform: translateY(-8px) scale(1.02, 0.98); /* ã‚¸ãƒ£ãƒ³ãƒ— */
            }
            98% {
                transform: translateY(0) scale(1); /* ç€åœ° */
            }
        }

        .app-title {
            /* Varela Round (ä¸¸ã„ãƒ•ã‚©ãƒ³ãƒˆ) ã«å¤‰æ›´ */
            font-family: "Varela Round", sans-serif;
            font-size: 3.5rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 0.5rem;
            letter-spacing: -0.03em;
            
            /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨ */
            display: inline-block;
            animation: popJump 4s infinite ease-in-out;
            transform-origin: bottom center;
        }

        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä¸­èº« */
        .content-area {
            padding: 1.5rem;
            margin-top: -3rem;
            position: relative;
            z-index: 20;
            padding-bottom: 2rem;
        }

        /* ã‚«ãƒ¼ãƒ‰å…±é€š */
        .card {
            background: white;
            border-radius: 24px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            border: 2px solid #f1f5f9;
            margin-bottom: 1rem;
        }

        /* æ™‚é–“å…¥åŠ› */
        input[type="datetime-local"] {
            font-family: "Barlow Semi Condensed", sans-serif;
            font-size: 1.3rem;
            color: #475569;
            background: #f8fafc;
            border: none;
            border-radius: 16px;
            padding: 1rem;
            width: 100%;
            text-align: center;
            outline: none;
            font-weight: 600;
            -webkit-appearance: none;
            letter-spacing: 0.02em;
        }
        input[type="datetime-local"]:focus {
            background: #ecfdf5;
            color: #059669;
            box-shadow: inset 0 0 0 3px #10b981;
        }

        /* ãƒ¢ãƒ¼ãƒ‰é¸æŠãƒœã‚¿ãƒ³ */
        .mode-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }
        
        .mode-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem 0.2rem;
            border-radius: 20px;
            background: #f8fafc;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .mode-btn.active {
            background: #fff;
            border-color: #10b981;
            box-shadow: 0 10px 20px -5px rgba(16, 185, 129, 0.3);
            transform: translateY(-2px);
            border-width: 3px;
        }

        .mode-icon {
            font-size: 1.8rem;
            margin-bottom: 0.25rem;
        }
        .mode-label {
            font-size: 0.85rem;
            font-weight: bold;
            color: #64748b;
        }
        .mode-time {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-top: 2px;
            font-family: "Barlow Semi Condensed", sans-serif;
            font-weight: 600;
        }
        .mode-btn.active .mode-label { color: #059669; }
        .mode-btn.active .mode-time { color: #10b981; }

        /* çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .timeline {
            position: relative;
            padding-left: 20px;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 10px;
            bottom: 10px;
            width: 4px;
            background: #e2e8f0;
            border-radius: 4px;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 1.8rem;
            padding-left: 1.5rem;
        }
        .timeline-item:last-child { margin-bottom: 0; }
        
        .timeline-dot {
            position: absolute;
            left: -5px;
            top: 5px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: white;
            border: 4px solid #cbd5e1;
            z-index: 1;
        }
        .timeline-item.highlight .timeline-dot {
            border-color: #10b981;
            background: #10b981;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.2);
        }

        /* æ•°å­—è¡¨ç¤º */
        .time-display {
            font-family: "Barlow Semi Condensed", sans-serif;
            letter-spacing: 0.02em;
            color: #475569;
        }
        #startTimeDisplay {
            color: #334155; 
        }

        /* ãƒœã‚¿ãƒ³ */
        .btn-main {
            width: 100%;
            background: #10b981;
            color: white;
            font-weight: bold;
            padding: 1.2rem;
            border-radius: 100px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        .btn-main:active {
            transform: scale(0.98);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .anim-up { animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .hidden { display: none; }

    </style>
</head>

<body>

    <div class="app-container">
        
        <!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
        <div class="scroll-view">
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <div class="header-bg">
                <h1 class="app-title">MamoRun</h1>
                <p class="text-sm opacity-90 font-medium">é€†ç®—ã—ã¦ã€ã¡ã‚‡ã†ã©ã‚ˆãå‹•ãã€‚</p>
            </div>

            <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <div class="content-area space-y-6">

                <!-- 1. é›†åˆæ™‚é–“å…¥åŠ› -->
                <div class="card anim-up" style="animation-delay: 0s;">
                    <label class="block text-xs font-bold text-gray-400 mb-2 tracking-widest">é›†åˆæ™‚é–“ (GOAL)</label>
                    <input type="datetime-local" id="meetingTime" onchange="calculateSchedule()">
                </div>

                <!-- 2. æº–å‚™ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
                <div class="anim-up" style="animation-delay: 0.1s;">
                    <label class="block text-xs font-bold text-gray-400 mb-2 px-1 tracking-widest">æº–å‚™ãƒ¢ãƒ¼ãƒ‰ (MODE)</label>
                    <div class="mode-grid">
                        <!-- æœ€çŸ­ãƒ¢ãƒ¼ãƒ‰ -->
                        <div class="mode-btn" onclick="selectMode(15, this)" id="modeRush">
                            <span class="mode-icon">ğŸƒ</span>
                            <span class="mode-label">ãŠæ€¥ã</span>
                            <span class="mode-time">15 min</span>
                        </div>
                        <!-- é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ (Default) -->
                        <div class="mode-btn active" onclick="selectMode(45, this)" id="modeNormal">
                            <span class="mode-icon">â˜•ï¸</span>
                            <span class="mode-label">ã„ã¤ã‚‚ã®</span>
                            <span class="mode-time">45 min</span>
                        </div>
                        <!-- ã—ã£ã‹ã‚Šãƒ¢ãƒ¼ãƒ‰ -->
                        <div class="mode-btn" onclick="selectMode(90, this)" id="modePerfect">
                            <span class="mode-icon">âœ¨</span>
                            <span class="mode-label">ã—ã£ã‹ã‚Š</span>
                            <span class="mode-time">90 min</span>
                        </div>
                    </div>
                </div>

                <!-- 3. çµæœã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ -->
                <div id="resultArea" class="card anim-up hidden" style="animation-delay: 0.2s;">
                    <div class="timeline">
                        
                        <!-- æº–å‚™é–‹å§‹ (ã“ã“ãŒä¸€ç•ªé‡è¦) -->
                        <div class="timeline-item highlight">
                            <div class="timeline-dot"></div>
                            <p class="text-xs font-bold text-emerald-600 mb-1">æº–å‚™ã‚¹ã‚¿ãƒ¼ãƒˆ</p>
                            <p id="startTimeDisplay" class="text-3xl font-bold leading-none time-display">--:--</p>
                            <p class="text-xs text-gray-400 mt-1">ã“ã“ã‹ã‚‰æº–å‚™é–‹å§‹</p>
                        </div>

                        <!-- å‡ºç™º -->
                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <p class="text-xs font-bold text-gray-400 mb-1">å®¶ã‚’å‡ºã‚‹</p>
                            <div class="flex items-baseline gap-2">
                                <p id="leaveTimeDisplay" class="text-xl font-bold time-display">--:--</p>
                                <span class="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded-full">ç§»å‹• 45åˆ† (ä»®)</span>
                            </div>
                        </div>

                        <!-- åˆ°ç€ -->
                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <p class="text-xs font-bold text-gray-400 mb-1">ç›®çš„åœ°ã«åˆ°ç€</p>
                            <p id="goalTimeDisplay" class="text-xl font-bold time-display">--:--</p>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- å›ºå®šãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ï¼‰ -->
        <div class="footer-area">
            <button onclick="setReminder()" class="btn-main">
                <span>ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚»ãƒƒãƒˆ</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </button>
        </div>

    </div>

    <!-- ã‚·ãƒ³ãƒ—ãƒ«ã‚¢ãƒ©ãƒ¼ãƒˆ -->
    <div id="alertBox" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center hidden z-[100]">
        <div class="bg-white p-6 rounded-3xl w-10/12 max-w-xs text-center shadow-2xl">
            <h3 class="text-xl font-bold text-emerald-600 mb-2">ãŠçŸ¥ã‚‰ã›</h3>
            <p id="alertText" class="text-gray-600 mb-6 font-medium"></p>
            <button onclick="closeAlert()" class="w-full bg-gray-100 text-gray-800 font-bold py-3 rounded-xl hover:bg-gray-200">OK</button>
        </div>
    </div>

    <script>
        // è¨­å®šå€¤
        const MOCK_TRAVEL_TIME_MIN = 45; // ç§»å‹•æ™‚é–“ï¼ˆä»Šå›ã¯å›ºå®šï¼‰
        let currentPrepTimeMin = 45; // åˆæœŸå€¤: USUALãƒ¢ãƒ¼ãƒ‰
        let reminderTimeoutId = null;

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            const now = new Date();
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’ä»Šã®1æ™‚é–“å¾Œã«è¨­å®šã—ã¦ã€ä½¿ã„æ‰‹ãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã‚„ã™ãã™ã‚‹
            now.setHours(now.getHours() + 2);
            now.setMinutes(0);
            
            const toLocalISO = (date) => {
                const pad = (n) => n.toString().padStart(2, '0');
                return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())}T${pad(date.getHours())}:${pad(date.getMinutes())}`;
            };
            
            document.getElementById('meetingTime').value = toLocalISO(now);
            
            if ('Notification' in window && Notification.permission !== 'granted') {
                Notification.requestPermission();
            }

            // åˆå›ã®è¨ˆç®—å®Ÿè¡Œ
            calculateSchedule();
        });

        // ãƒ¢ãƒ¼ãƒ‰é¸æŠå‡¦ç†
        function selectMode(minutes, element) {
            currentPrepTimeMin = minutes;
            
            // ã‚¹ã‚¿ã‚¤ãƒ«ã®åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            element.classList.add('active');

            // å†è¨ˆç®—
            calculateSchedule();
        }

        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå…¥åŠ›ã‚„ãƒ¢ãƒ¼ãƒ‰å¤‰æ›´æ™‚ã«å³æ™‚åæ˜ ï¼‰
        function calculateSchedule() {
            const meetingTimeVal = document.getElementById('meetingTime').value;
            if (!meetingTimeVal) return;

            const meetingDate = new Date(meetingTimeVal);
            
            // 1. å‡ºç™ºæ™‚é–“ = é›†åˆ - ç§»å‹•
            const leaveDate = new Date(meetingDate.getTime() - (MOCK_TRAVEL_TIME_MIN * 60 * 1000));
            
            // 2. æº–å‚™é–‹å§‹æ™‚é–“ = å‡ºç™º - æº–å‚™ãƒ¢ãƒ¼ãƒ‰æ™‚é–“
            const startDate = new Date(leaveDate.getTime() - (currentPrepTimeMin * 60 * 1000));

            // è¡¨ç¤ºæ›´æ–°
            const timeFormat = { hour: '2-digit', minute: '2-digit' };
            
            document.getElementById('startTimeDisplay').textContent = startDate.toLocaleTimeString('ja-JP', timeFormat);
            document.getElementById('leaveTimeDisplay').textContent = leaveDate.toLocaleTimeString('ja-JP', timeFormat);
            document.getElementById('goalTimeDisplay').textContent = meetingDate.toLocaleTimeString('ja-JP', timeFormat);

            // çµæœã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
            const resultArea = document.getElementById('resultArea');
            resultArea.classList.remove('hidden');
        }

        // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚»ãƒƒãƒˆ
        function setReminder() {
            const meetingTimeVal = document.getElementById('meetingTime').value;
            if (!meetingTimeVal) {
                showAlert('é›†åˆæ™‚é–“ã‚’è¨­å®šã—ã¦ãã ã•ã„');
                return;
            }

            const meetingDate = new Date(meetingTimeVal);
            const now = new Date();
            
            // æº–å‚™é–‹å§‹æ™‚é–“ã®å†è¨ˆç®—
            const leaveDateMs = meetingDate.getTime() - (MOCK_TRAVEL_TIME_MIN * 60 * 1000);
            const startDateMs = leaveDateMs - (currentPrepTimeMin * 60 * 1000);
            
            const timeUntilStart = startDateMs - now.getTime();

            if (timeUntilStart <= 0) {
                showAlert('æº–å‚™é–‹å§‹æ™‚é–“ã‚’éãã¦ã„ã¾ã™ï¼\nã€ŒãŠæ€¥ãã€ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã‹ã€æ™‚é–“ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            if (reminderTimeoutId) clearTimeout(reminderTimeoutId);

            reminderTimeoutId = setTimeout(() => {
                new Notification("MamoRun", {
                    body: "æº–å‚™ã‚’é–‹å§‹ã™ã‚‹æ™‚é–“ã§ã™ï¼ã‚†ã£ãã‚Šæ”¯åº¦ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚",
                    icon: "https://placehold.co/64x64/10b981/ffffff?text=Go"
                });
                showAlert('æ™‚é–“ã«ãªã‚Šã¾ã—ãŸï¼\næº–å‚™ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚');
            }, timeUntilStart);

            const minutesLeft = Math.ceil(timeUntilStart / 1000 / 60);
            showAlert(`ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚\n${minutesLeft}åˆ†å¾Œã«é€šçŸ¥ã—ã¾ã™ã€‚`);
        }

        // ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ
        function showAlert(msg) {
            document.getElementById('alertText').innerText = msg;
            document.getElementById('alertBox').classList.remove('hidden');
        }
        function closeAlert() {
            document.getElementById('alertBox').classList.add('hidden');
        }

    </script>
    <script>
        (function (d) {
            var config = {
                kitId: 'ohm1sor',
                scriptTimeout: 3000,
                async: true
            },
                h = d.documentElement, t = setTimeout(function () { h.className = h.className.replace(/\bwf-loading\b/g, "") + " wf-inactive"; }, config.scriptTimeout), tk = d.createElement("script"), f = false, s = d.getElementsByTagName("script")[0], a; h.className = "wf-loading"; tk.src = 'https://use.typekit.net/' + config.kitId + '.js'; tk.async = true; tk.onload = tk.onreadystatechange = function () { a = this.readyState; if (f || a && a != "complete" && a != "loaded") return; f = true; clearTimeout(t); try { Typekit.load(config) } catch (e) { } }; s.parentNode.insertBefore(tk, s)
        })(document);
    </script>
</body>
</html>
